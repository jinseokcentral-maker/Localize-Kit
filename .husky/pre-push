#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

echo "üß™ Running tests before push (concurrent)..."
echo ""

# Run frontend and backend tests concurrently
cd frontend && pnpm run test -- --run > /tmp/frontend-test.log 2>&1 &
FRONTEND_PID=$!

cd ../backend && pnpm run test > /tmp/backend-test.log 2>&1 &
BACKEND_PID=$!

# Wait for both tests to complete
wait $FRONTEND_PID
FRONTEND_EXIT=$?

wait $BACKEND_PID
BACKEND_EXIT=$?

# Check results
if [ $FRONTEND_EXIT -ne 0 ]; then
  echo ""
  echo "‚ùå Frontend tests failed:"
  cat /tmp/frontend-test.log
  exit 1
fi

if [ $BACKEND_EXIT -ne 0 ]; then
  echo ""
  echo "‚ùå Backend tests failed:"
  cat /tmp/backend-test.log
  exit 1
fi

echo ""
echo "‚úÖ All tests passed! Pushing..."

